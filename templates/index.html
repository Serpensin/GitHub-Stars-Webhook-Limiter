<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Events Limiter - Repository Management</title>
    <link rel="stylesheet" href="/static/style.css">
    <script>
        // CSRF token for API authentication - session-specific
        // Even if someone sees this token, they can't use it from a different session
        window.CSRF_TOKEN = "{{ csrf_token }}";
    </script>
</head>
<body>
    <div class="container">
     <header>
            <h1>&#128276; GitHub Events Limiter</h1>
            <p>Manage your GitHub webhook notifications to Discord</p>
            <div style="text-align: right; margin-top: 10px;">
                <a href="/admin" style="color: #666; text-decoration: none; font-size: 0.9em;">🔐 Admin Panel</a>
            </div>
    </header>

        <div class="tabs">
      <button class="tab-button active" onclick="showTab('add')">Add Repository</button>
 <button class="tab-button" onclick="showTab('manage')">Manage Repository</button>
        </div>

     <!-- Add Repository Tab -->
     <div id="add-tab" class="tab-content active">
 <div class="card">
           <h2>Add New Repository</h2>
      <form id="add-form">
 <div class="form-group">
      <label for="add-repo-url">GitHub Repository URL *</label>
    <input type="url" id="add-repo-url" placeholder="https://github.com/owner/repo" required>
      <small>The full URL to your GitHub repository</small>
       </div>

    <div class="form-group">
    <label for="add-secret">Webhook Secret *</label>
              <div class="input-group">
          <input type="text" id="add-secret" placeholder="Enter or generate a secret" required>
         <button type="button" class="btn btn-secondary" onclick="generateSecret('add-secret')">Generate</button>
 <button type="button" class="btn btn-secondary" onclick="copyToClipboard('add-secret')">Copy</button>
    </div>
           <small>This secret must match the one you configure in GitHub webhook settings</small>
        </div>

<div class="form-group">
   <label for="add-discord-webhook">Discord Webhook URL *</label>
               <input type="url" id="add-discord-webhook" placeholder="https://discord.com/api/webhooks/..." required>
    <small>Your Discord webhook URL for notifications</small>
              </div>

            <div class="form-group">
      <label>Enabled Events *</label>
       <div class="checkbox-group">
          <label class="checkbox-label">
             <input type="checkbox" name="events" value="star" checked> Star Events
        </label>
           <label class="checkbox-label">
          <input type="checkbox" name="events" value="watch" checked> Watch Events
    </label>
       </div>
        <small>Select which GitHub events should trigger Discord notifications</small>
   </div>

          <button type="submit" class="btn btn-primary">Add Repository</button>
          </form>
            </div>
    </div>

        <!-- Manage Repository Tab -->
        <div id="manage-tab" class="tab-content">
     <div class="card">
        <h2>Verify Repository Access</h2>
     <p>Enter your repository credentials to edit or delete a configuration.</p>
  <form id="verify-form">
        <div class="form-group">
       <label for="verify-repo-url">GitHub Repository URL *</label>
             <input type="url" id="verify-repo-url" placeholder="https://github.com/owner/repo" required>
                    </div>

            <div class="form-group">
 <label for="verify-secret">Current Webhook Secret *</label>
            <input type="password" id="verify-secret" placeholder="Enter your current secret" required>
                </div>

            <div class="form-group">
    <label for="verify-discord-webhook">Current Discord Webhook URL *</label>
              <input type="url" id="verify-discord-webhook" placeholder="https://discord.com/api/webhooks/..." required>
               </div>

          <button type="submit" class="btn btn-primary">Verify & Load</button>
    </form>
  </div>

         <!-- Edit/Delete Form (hidden until verified) -->
            <div id="edit-section" class="card" style="display: none;">
   <h2>Update Repository Configuration</h2>
       <form id="edit-form">
    <input type="hidden" id="edit-repo-id">
 <input type="hidden" id="edit-old-secret">

       <div class="form-group">
    <label>Repository</label>
    <input type="text" id="edit-repo-name" disabled>
          </div>

             <div class="form-group">
            <label for="edit-new-secret">New Webhook Secret (leave empty to keep current)</label>
           <div class="input-group">
              <input type="text" id="edit-new-secret" placeholder="Enter new secret or leave empty">
         <button type="button" class="btn btn-secondary" onclick="generateSecret('edit-new-secret')">Generate</button>
     <button type="button" class="btn btn-secondary" onclick="copyToClipboard('edit-new-secret')">Copy</button>
       </div>
   </div>

          <div class="form-group">
   <label for="edit-discord-webhook">New Discord Webhook URL (leave empty to keep current)</label>
               <input type="url" id="edit-discord-webhook" placeholder="https://discord.com/api/webhooks/...">
       </div>

    <div class="form-group">
     <label>Enabled Events</label>
                 <div class="checkbox-group">
     <label class="checkbox-label">
 <input type="checkbox" name="edit-events" value="star" id="edit-event-star"> Star Events
   </label>
         <label class="checkbox-label">
               <input type="checkbox" name="edit-events" value="watch" id="edit-event-watch"> Watch Events
            </label>
 </div>
             </div>

 <div class="button-group">
          <button type="submit" class="btn btn-primary">Update Repository</button>
    <button type="button" class="btn btn-danger" onclick="deleteRepository()">Delete Repository</button>
           </div>
   </form>
          </div>
        </div>

        <!-- Status Messages -->
        <div id="status-message" class="status-message"></div>

        <!-- Instructions -->
        <div class="card instructions">
          <h2>&#128221; Setup Instructions</h2>
 <ol>
                <li><strong>Add Repository:</strong> Fill in the form above with your repository URL, webhook secret, and Discord webhook URL.</li>
 <li><strong>Generate Secret:</strong> Click "Generate" to create a secure random secret, then copy it.</li>
        <li><strong>Configure GitHub Webhook:</strong>
         <ul>
           <li>Go to your GitHub repository → Settings → Webhooks → Add webhook</li>
             <li>Set Payload URL to: <code id="webhook-url"></code></li>
       <li>Set Content type to: <code>application/json</code></li>
               <li>Paste your secret in the "Secret" field</li>
         <li>Select events: <strong>Stars</strong> and/or <strong>Watches</strong></li>
    <li>Ensure "Active" is checked</li>
    <li>Click "Add webhook"</li>
  </ul>
     </li>
       <li><strong>Test:</strong> Star or watch your repository to verify Discord notifications work!</li>
        </ol>
        </div>
    </div>

    <footer>
        <p>GitHub Events Limiter v2.0.0 | <a href="https://github.com/Serpensin/GitHub-Stars-Webhook-Limiter" target="_blank">Source Code</a></p>
    </footer>

    <script src="/static/script.js"></script>
</body>
</html>
